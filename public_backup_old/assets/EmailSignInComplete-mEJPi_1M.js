import{a as s,j as e}from"./vendor-BOJOR_z2.js";import{H as w}from"./Helmet-D3USV4CJ.js";import{a as S,u as k,w as E,x as N,y as x}from"./index-BYuk7_JU.js";import{p as I,t as L,v as b,w as F,q as W,o as h,B as f,I as P}from"./contact-C28TQl3y.js";import"./index-PjsTQpNX.js";const M=()=>{const[d,n]=s.useState(!0),[l,g]=s.useState(!1),[p,r]=s.useState(!1),[y,o]=s.useState(""),[c,u]=s.useState(""),{toast:i}=S(),[,a]=k();s.useEffect(()=>{(async()=>{if(!E(window.location.href)){n(!1),r(!0),o("Invalid sign-in link. Please request a new link.");return}const m=N();if(m){u(m);try{await x(m,window.location.href),i({title:"Login Successful",description:"You have been successfully signed in!"}),a("/profile-setup")}catch(C){n(!1),r(!0),o(C.message||"Failed to complete sign-in. The link may have expired.")}}else n(!1)})()},[i,a]);const j=async()=>{if(!c){i({variant:"destructive",title:"Email Required",description:"Please enter your email address to complete sign-in."});return}g(!0);try{await x(c,window.location.href),i({title:"Login Successful",description:"You have been successfully signed in!"}),a("/profile-setup")}catch(t){r(!0),o(t.message||"Failed to complete sign-in. Please try again."),i({variant:"destructive",title:"Login Failed",description:t.message||"Failed to complete sign-in. Please try again."})}finally{g(!1)}},v=t=>{u(t.target.value)};return e.jsxs(e.Fragment,{children:[e.jsxs(w,{children:[e.jsx("title",{children:"Complete Sign-In | WorkWise SA"}),e.jsx("meta",{name:"description",content:"Complete your sign-in to WorkWise SA"})]}),e.jsx("main",{className:"flex-grow bg-light flex items-center justify-center py-10",children:e.jsxs(I,{className:"w-full max-w-md mx-4",children:[e.jsxs(L,{className:"space-y-1",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/images/logo.png",alt:"WorkWise SA Logo",className:"h-36 md:h-40 object-contain transition-all duration-200 hover:scale-105"})}),e.jsx(b,{className:"text-2xl font-bold text-center",children:"Complete Sign-In"}),e.jsx(F,{className:"text-center",children:d?"Verifying your sign-in link...":p?"There was a problem with your sign-in link":"Please confirm your email to complete sign-in"})]}),e.jsx(W,{children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(h,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"mt-4 text-sm text-muted",children:"Completing your sign-in..."})]}):p?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-destructive mb-4",children:y}),e.jsx(f,{onClick:()=>a("/email-link-login"),className:"bg-primary",children:"Try Again"})]}):e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx("p",{className:"text-sm text-muted",children:"Please confirm your email address to complete the sign-in process:"}),e.jsx("div",{className:"space-y-2",children:e.jsx(P,{type:"email",placeholder:"Your email address",value:c,onChange:v,disabled:l})}),e.jsx(f,{className:"w-full bg-primary",onClick:j,disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mr-2 h-4 w-4 animate-spin"}),"Completing sign-in..."]}):"Complete Sign-In"})]})})]})})]})};export{M as default};
