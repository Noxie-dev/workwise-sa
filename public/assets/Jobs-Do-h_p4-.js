import{a as p,j as e,u as N,e as S}from"./vendor-BOJOR_z2.js";import{u as f,a as E}from"./index-BYuk7_JU.js";import{p as R,q as C,s as J,I as T,B as u}from"./contact-C28TQl3y.js";import{J as A}from"./JobCard-ORdKAsNj.js";import{S as c}from"./skeleton-DTk9rcAT.js";import{a as n}from"./apiClient-Ddw1nvhZ.js";import"./badge-Dbv6MStK.js";const P=({initialQuery:s="",className:a=""})=>{const[r,d]=p.useState(s),[j,l]=f(),x=m=>{if(m.preventDefault(),j.startsWith("/jobs")){const h=new URL(window.location.href);h.searchParams.set("q",r),l(`/jobs?${h.searchParams.toString()}`)}else l(`/jobs?q=${encodeURIComponent(r)}`)};return e.jsx(R,{className:`bg-white shadow-md ${a}`,children:e.jsx(C,{className:"p-4",children:e.jsx("form",{onSubmit:x,children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(J,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(T,{type:"text",placeholder:"Search for: cashier, security, cleaner, nanny...",className:"pl-10 w-full",value:r,onChange:m=>d(m.target.value)})]}),e.jsx(u,{type:"submit",className:"bg-primary text-white hover:bg-blue-600",children:"Search Jobs"})]})})})})},g={async getJobs(){return(await n.get("/jobs")).data},async getJobById(s){return(await n.get(`/jobs/${s}`)).data},async searchJobs(s){return(await n.get("/jobs/search",{params:s})).data},async getFeaturedJobs(s=6){return(await n.get("/jobs/featured",{params:{limit:s}})).data},async getCategories(){return(await n.get("/categories")).data},async getCategoryWithJobs(s){return(await n.get(`/categories/${s}/jobs`)).data},async getCompanies(){return(await n.get("/companies")).data},async getCompanyWithJobs(s){return(await n.get(`/companies/${s}/jobs`)).data},async toggleFavorite(s,a){a?await n.post(`/jobs/${s}/favorite`):await n.delete(`/jobs/${s}/favorite`)},async getFavoriteJobs(){return(await n.get("/jobs/favorites")).data},async applyForJob(s,a){return(await n.post(`/jobs/${s}/apply`,a)).data}},F={searchParams:new URLSearchParams,searchQuery:"",favorites:new Set},_=(s,a)=>{switch(a.type){case"SET_SEARCH_PARAMS":return{...s,searchParams:a.payload};case"SET_SEARCH_QUERY":return{...s,searchQuery:a.payload};case"TOGGLE_FAVORITE":{const r=new Set(s.favorites);return a.payload.isFavorite?r.add(a.payload.jobId):r.delete(a.payload.jobId),{...s,favorites:r}}default:return s}},H=()=>{var b;const[s]=f(),[a,r]=p.useReducer(_,F),{toast:d}=E(),{searchParams:j,searchQuery:l,favorites:x}=a;p.useEffect(()=>{const t=new URLSearchParams(window.location.search);r({type:"SET_SEARCH_PARAMS",payload:t}),r({type:"SET_SEARCH_QUERY",payload:t.get("q")||""})},[s]);const m=p.useCallback(async(t,o)=>{try{r({type:"TOGGLE_FAVORITE",payload:{jobId:t,isFavorite:o}}),await g.toggleFavorite(t,o),d({title:o?"Job added to favorites":"Job removed from favorites",description:o?"You can view your favorites in your profile":"The job has been removed from your favorites"})}catch{r({type:"TOGGLE_FAVORITE",payload:{jobId:t,isFavorite:!o}}),d({variant:"destructive",title:"Failed to update favorites",description:"Please try again later"})}},[d]),h={query:l,page:1,limit:20},{data:i,isLoading:y,error:w}=N({queryKey:["jobs","search",h],queryFn:()=>g.searchJobs(h),staleTime:5*60*1e3}),v=()=>Array(6).fill(0).map((t,o)=>e.jsxs("div",{className:"bg-white rounded-lg shadow-card overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"w-12 h-12 rounded-md mr-3"}),e.jsxs("div",{children:[e.jsx(c,{className:"h-5 w-40 mb-2"}),e.jsx(c,{className:"h-4 w-32"})]})]}),e.jsx(c,{className:"h-8 w-8 rounded-full"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{className:"h-5 w-16 rounded-full"}),e.jsx(c,{className:"h-5 w-16 rounded-full"})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(c,{className:"h-5 w-24"}),e.jsx(c,{className:"h-4 w-20"})]})]})]},o));return e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsx("title",{children:"Browse Jobs | WorkWise SA"}),e.jsx("meta",{name:"description",content:"Find job opportunities in South Africa. Search, filter and apply for jobs across all industries."})]}),e.jsx("main",{className:"flex-grow bg-light py-8",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Find Your Dream Job"}),e.jsx("p",{className:"text-muted",children:"Browse through our comprehensive list of jobs across South Africa"})]}),e.jsx(P,{initialQuery:l,className:"mb-8"}),l&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-2",children:["Search Results ",jobs&&`(${jobs.length})`]}),l&&e.jsxs("p",{className:"text-muted",children:["Showing results for: ",e.jsx("span",{className:"font-medium",children:l})]})]}),w?e.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Failed to load jobs. Please try again later."}),e.jsx(u,{onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:y?v():(b=i==null?void 0:i.jobs)!=null&&b.length?i.jobs.map(t=>e.jsx(A,{job:t,onFavoriteToggle:m},t.id)):e.jsxs("div",{className:"col-span-full text-center p-8 bg-white rounded-lg shadow",children:[e.jsx("p",{className:"text-xl font-medium mb-2",children:"No jobs found"}),e.jsx("p",{className:"text-muted mb-4",children:"Try adjusting your search criteria"}),i&&i.total===0&&l&&e.jsx(u,{variant:"outline",onClick:()=>{r({type:"SET_SEARCH_QUERY",payload:""}),window.history.pushState({},"","/jobs")},children:"Clear search"})]})}),i&&i.totalPages>1&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx("div",{className:"flex space-x-2",children:Array.from({length:i.totalPages},(t,o)=>o+1).map(t=>e.jsx(u,{variant:t===i.page?"default":"outline",size:"sm",onClick:()=>{const o=new URLSearchParams(j);o.set("page",t.toString()),window.history.pushState({},"",`/jobs?${o.toString()}`),window.dispatchEvent(new Event("popstate"))},children:t},t))})})]})})]})};export{H as default};
