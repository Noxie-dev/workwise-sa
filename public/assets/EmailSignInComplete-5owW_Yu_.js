import{j as e}from"./vendor-ui-s4VaHhe3.js";import{b as s}from"./vendor-react-BLR_YkO_.js";import{H as S}from"./Helmet-0wtNoWcg.js";import{u as k}from"./vendor-router-B3zuYAIM.js";import{C as E,b as N,c as w,d as b,a as I}from"./card-BYeanzy8.js";import{u as L,B as x,m as F,n as W,o as f}from"./index-BNVlULwE.js";import{I as P}from"./input-BNh8B9Wi.js";import{i as h}from"./vendor-icons-CgtSIdDt.js";import"./vendor-charts-CaNT0DhE.js";import"./vendor-query-Cm3gWw8b.js";const G=()=>{const[d,n]=s.useState(!0),[r,p]=s.useState(!1),[g,l]=s.useState(!1),[y,o]=s.useState(""),[c,u]=s.useState(""),{toast:i}=L(),[,a]=k();s.useEffect(()=>{(async()=>{if(!F(window.location.href)){n(!1),l(!0),o("Invalid sign-in link. Please request a new link.");return}const m=W();if(m){u(m);try{await f(m,window.location.href),i({title:"Login Successful",description:"You have been successfully signed in!"}),a("/profile-setup")}catch(v){n(!1),l(!0),o(v.message||"Failed to complete sign-in. The link may have expired.")}}else n(!1)})()},[i,a]);const j=async()=>{if(!c){i({variant:"destructive",title:"Email Required",description:"Please enter your email address to complete sign-in."});return}p(!0);try{await f(c,window.location.href),i({title:"Login Successful",description:"You have been successfully signed in!"}),a("/profile-setup")}catch(t){l(!0),o(t.message||"Failed to complete sign-in. Please try again."),i({variant:"destructive",title:"Login Failed",description:t.message||"Failed to complete sign-in. Please try again."})}finally{p(!1)}},C=t=>{u(t.target.value)};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsx("title",{children:"Complete Sign-In | WorkWise SA"}),e.jsx("meta",{name:"description",content:"Complete your sign-in to WorkWise SA"})]}),e.jsx("main",{className:"flex-grow bg-light flex items-center justify-center py-10",children:e.jsxs(E,{className:"w-full max-w-md mx-4",children:[e.jsxs(N,{className:"space-y-1",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/images/logo.png",alt:"WorkWise SA Logo",className:"h-36 md:h-40 object-contain transition-all duration-200 hover:scale-105"})}),e.jsx(w,{className:"text-2xl font-bold text-center",children:"Complete Sign-In"}),e.jsx(b,{className:"text-center",children:d?"Verifying your sign-in link...":g?"There was a problem with your sign-in link":"Please confirm your email to complete sign-in"})]}),e.jsx(I,{children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(h,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"mt-4 text-sm text-muted",children:"Completing your sign-in..."})]}):g?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-destructive mb-4",children:y}),e.jsx(x,{onClick:()=>a("/email-link-login"),className:"bg-primary",children:"Try Again"})]}):e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx("p",{className:"text-sm text-muted",children:"Please confirm your email address to complete the sign-in process:"}),e.jsx("div",{className:"space-y-2",children:e.jsx(P,{type:"email",placeholder:"Your email address",value:c,onChange:C,disabled:r})}),e.jsx(x,{className:"w-full bg-primary",onClick:j,disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mr-2 h-4 w-4 animate-spin"}),"Completing sign-in..."]}):"Complete Sign-In"})]})})]})})]})};export{G as default};
